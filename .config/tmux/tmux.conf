####
#### rebindings ####
####

# for quick reload of config
unbind r
bind r source-file ~/.config/tmux/tmux.conf


# Set prefix to Ctrl-Space
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# open splits in current path
bind '%' split-window -h -c "#{pane_current_path}"
bind '"' split-window -v -c "#{pane_current_path}"


####
#### options ###
####

set -g status-interval 1
set -g escape-time 20
set -g repeat-time 350
set -g display-time 1500

# set focus events on for nvim
set -g focus-events on

# options for color ####
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# options for indexes for window/session creation ###
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on
set -g mouse on

####
#### improved copy mode ####
####

set-window-option -g mode-keys vi
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

#####
##### Display Popups ##### 
#####

# lazygit
bind C-y display-popup \
  -d "#{pane_current_path}" \
  -w 80% \
  -h 80% \
  -E "lazygit"

# new session
bind C-n display-popup -E 'bash -i -c "read -p \"Session name: \" name; tmux new-session -d -s \$name && tmux switch-client -t \$name"'

#####
##### Display Menu ##### 
#####

bind d display-menu -T "#[align=centre]Dotfiles" -x C -y C \
  ".zshrc"            z  "display-popup -E 'nvim ~/.zshrc'" \
  ".tmux.conf"        t  "display-popup -E 'nvim ~/.tmux.conf'" \
  "Exit"              q  ""

#####
##### Bootstrap Plugins ##### 
#####

if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-online-status'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'catppuccin/tmux'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'alexwforsythe/tmux-which-key'   ## prefix + space
set -g @plugin 'kristijan/tmux-fzf-pane-switch' ## prefix + s

####
#### Configure Catppuccin ####
####

source-file ~/.config/tmux/appearance.conf

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
